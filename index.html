<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CES 2026 åœ°å›³æ©Ÿèƒ½ - ã‚¹ãƒ†ãƒƒãƒ—2ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼‰</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f5f1e8;
            color: #5d4e37;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: #5d4e37;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e8dcc8;
        }
        
        .info h2 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #7ea355;
        }
        
        .info p {
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        #map {
            height: 600px;
            border: 2px solid #e8dcc8;
            border-radius: 8px;
            background: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
            color: #7ea355;
        }
        
        .stats {
            background: #a8c686;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        /* Leaflet popup ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        
        .leaflet-popup-content {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }
        
        .popup-company-name {
            font-weight: bold;
            color: #5d4e37;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .popup-info {
            color: #8b7d6b;
            font-size: 0.9rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ CES 2026 åœ°å›³æ©Ÿèƒ½ - ã‚¹ãƒ†ãƒƒãƒ—2</h1>
        
        <div class="info">
            <h2>å®Ÿè£…å†…å®¹</h2>
            <p>âœ“ PapaParseã§CSVãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</p>
            <p>âœ“ ãƒšãƒ¼ã‚¸11ã®å…¨ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º</p>
            <p>âœ“ å…¨ãƒ”ãƒ³ã‚’åœ°å›³ä¸Šã«è¡¨ç¤ºï¼ˆç´„595å€‹ï¼‰</p>
            <p>âœ“ ãƒ”ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ä¼æ¥­æƒ…å ±ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º</p>
        </div>
        
        <div id="stats" class="stats">
            ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...
        </div>
        
        <div id="map" class="loading">
            åœ°å›³ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- PapaParse for CSV -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <script>
        // ç”»åƒã‚µã‚¤ã‚ºï¼ˆ900 DPIã€é«˜è§£åƒåº¦ç‰ˆï¼‰
        const imageWidth = 11813;
        const imageHeight = 8925;
        
        // PDFåº§æ¨™ â†’ Leafletåº§æ¨™ã¸ã®å¤‰æ›é–¢æ•°
        // âš ï¸ é‡è¦: Excelã®PDFåº§æ¨™ã¯Letter Sizeï¼ˆ792Ã—612ptï¼‰åŸºæº–
        // å®Ÿéš›ã®PDFã¯ 945Ã—714pt ãªã®ã§ã€ã‚¹ã‚±ãƒ¼ãƒ«è£œæ­£ãŒå¿…è¦
        function pdfToLeaflet(pdfX, pdfY) {
            // ã‚¹ãƒ†ãƒƒãƒ—1: Letter Size â†’ å®Ÿéš›ã®PDFã‚µã‚¤ã‚ºã«è£œæ­£
            const scaleX = 945 / 792;  // 1.1932
            const scaleY = 714 / 612;  // 1.1667
            const adjustedX = pdfX * scaleX;
            const adjustedY = pdfY * scaleY;
            
            // ã‚¹ãƒ†ãƒƒãƒ—2: PDF â†’ PNG (900 DPI)
            const scale = 900 / 72;  // 600 DPIã‹ã‚‰900 DPIã«å¤‰æ›´
            const pngX = adjustedX * scale;
            const pngY = adjustedY * scale;
            
            // ã‚¹ãƒ†ãƒƒãƒ—3: Yè»¸åè»¢ï¼ˆLeaflet Simple CRSè¦ä»¶ï¼‰
            const leafletLat = imageHeight - pngY;
            const leafletLng = pngX;
            
            return [leafletLat, leafletLng];
        }
        
        // åœ°å›³ã®åˆæœŸåŒ–
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -2,      // ã‚ˆã‚Šç¸®å°å¯èƒ½ã«ï¼ˆ-1 â†’ -2ï¼‰
            maxZoom: 4,       // ã‚ˆã‚Šæ‹¡å¤§å¯èƒ½ã«ï¼ˆ3 â†’ 4ï¼‰
            zoomControl: true
        });
        
        // èƒŒæ™¯ç”»åƒã®é…ç½®
        const bounds = L.latLngBounds(
            L.latLng(0, 0),
            L.latLng(imageHeight, imageWidth)
        );
        
        L.imageOverlay('./page_11.png', bounds).addTo(map);
        map.fitBounds(bounds);
        
        // ãƒãƒ¼ã‚«ãƒ¼ç”¨ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—
        const markerLayer = L.layerGroup().addTo(map);
        
        // ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
        function createMarker(company) {
            const pdfX = parseFloat(company.PDF_X);
            const pdfY = parseFloat(company.PDF_Y);
            
            // åº§æ¨™ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
            if (isNaN(pdfX) || isNaN(pdfY)) {
                return null;
            }
            
            const [lat, lng] = pdfToLeaflet(pdfX, pdfY);
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é’ã„ãƒ”ãƒ³
            const marker = L.marker([lat, lng], {
                title: company['ä¼šç¤¾å']
            });
            
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å†…å®¹
            const popupContent = `
                <div class="popup-company-name">${company['ä¼šç¤¾å']}</div>
                <div class="popup-info">
                    ğŸ“ ãƒ–ãƒ¼ã‚¹: ${company['ãƒ–ãƒ¼ã‚¹ç•ªå·']}<br>
                    ğŸ¢ ä¼šå ´: ${company['ä¼šå ´']}
                </div>
            `;
            
            marker.bindPopup(popupContent);
            
            return marker;
        }
        
        // å…¨ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
        function displayMarkers(companies) {
            console.log(`ğŸ“ ãƒãƒ¼ã‚«ãƒ¼é…ç½®é–‹å§‹: ${companies.length}ç¤¾`);
            
            let successCount = 0;
            let failCount = 0;
            
            companies.forEach(company => {
                const marker = createMarker(company);
                if (marker) {
                    markerLayer.addLayer(marker);
                    successCount++;
                } else {
                    failCount++;
                }
            });
            
            console.log(`âœ… ãƒãƒ¼ã‚«ãƒ¼é…ç½®å®Œäº†: ${successCount}å€‹æˆåŠŸã€${failCount}å€‹å¤±æ•—`);
            
            // çµ±è¨ˆã‚’æ›´æ–°
            document.getElementById('stats').innerHTML = `
                âœ… ${successCount}å€‹ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ä¸Šã«é…ç½®ã—ã¾ã—ãŸ
                ${failCount > 0 ? `ï¼ˆåº§æ¨™ã‚¨ãƒ©ãƒ¼: ${failCount}å€‹ï¼‰` : ''}
            `;
        }
        
        // CSVãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨å‡¦ç†
        console.log('ğŸ“‚ CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹...');
        
        Papa.parse('./CES2026_page11_coordinates.csv', {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                console.log(`âœ“ CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: ${results.data.length}è¡Œ`);
                
                // ãƒšãƒ¼ã‚¸11ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆå¿µã®ãŸã‚ï¼‰
                const page11Data = results.data.filter(row => {
                    const page = parseFloat(row.PDFãƒšãƒ¼ã‚¸);
                    const hasCoords = row.PDF_X && row.PDF_Y;
                    return page === 11 && hasCoords;
                });
                
                console.log(`âœ“ ãƒšãƒ¼ã‚¸11ã®ä¼æ¥­æ•°: ${page11Data.length}ç¤¾`);
                
                // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
                displayMarkers(page11Data);
                
                // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                if (page11Data.length > 0) {
                    console.log('ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€åˆã®3ç¤¾ï¼‰:');
                    page11Data.slice(0, 3).forEach(company => {
                        console.log(`  - ${company['ä¼šç¤¾å']}: (${company.PDF_X}, ${company.PDF_Y})`);
                    });
                }
            },
            error: function(error) {
                console.error('âŒ CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('stats').innerHTML = `
                    âŒ CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}
                `;
                document.getElementById('stats').style.background = '#dc3545';
            }
        });
        
        // åœ°å›³ã®åˆæœŸåŒ–å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        console.log('âœ“ åœ°å›³ã®åˆæœŸåŒ–å®Œäº†');
    </script>
</body>
</html>
